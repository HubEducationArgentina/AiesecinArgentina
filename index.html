<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Login - Plataforma Educativa</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* Estilos mínimos para que se vea decente */
    body { font-family: Arial, sans-serif; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#0f1724; color:#fff; }
    .card { background:#111827; padding:24px; border-radius:8px; width:320px; box-shadow:0 6px 18px rgba(0,0,0,0.6); }
    input { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #333; background:#0b1220; color:#fff; }
    button { width:100%; padding:10px; margin-top:8px; border:0; border-radius:6px; background:#0ea5e9; color:#042028; font-weight:600; cursor:pointer; }
    .error { color:#ffb4b4; margin-top:8px; font-size:0.9em; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Iniciar sesión</h2>

    <form id="loginForm" autocomplete="off">
      <label for="user">Usuario</label>
      <input id="user" name="user" type="text" placeholder="Tu usuario" required />

      <label for="pass">Contraseña</label>
      <input id="pass" name="pass" type="password" placeholder="Contraseña" required />

      <button type="submit" id="btnLogin">Entrar</button>
      <div id="error" class="error" aria-live="polite"></div>
    </form>
  </div>

  <script>
    // Asignar listener al formulario
    document.getElementById('loginForm').addEventListener('submit', async function (ev) {
      ev.preventDefault();
      const btn = document.getElementById('btnLogin');
      const errEl = document.getElementById('error');
      errEl.textContent = '';

      const u = document.getElementById('user').value.trim();
      const p = document.getElementById('pass').value;

      if (!u || !p) {
        errEl.textContent = 'Por favor completa usuario y contraseña.';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Validando...';

      try {
        // IMPORTANTE:
        // - Si abres el archivo con file:// fetch no funcionará. Sirve con un servidor local (ej: Live Server, http-server).
        // - users.json debe estar servido desde el mismo origen o con CORS permitido.
        const res = await fetch('users.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('No se pudo cargar la lista de usuarios (revisa la ruta / CORS).');

        const users = await res.json();

        // Búsqueda: aquí usamos comparación case-insensitive en usuario
        const found = users.find(x => (x.username || '').toLowerCase() === u.toLowerCase() && (x.password || '') === p);

        if (!found) {
          errEl.textContent = 'Usuario o contraseña incorrectos.';
          btn.disabled = false;
          btn.textContent = 'Entrar';
          return;
        }

        // Guardar nombre de usuario (con el casing original guardado en users.json)
        // Usamos localStorage para persistir entre pestañas; si prefieres sesión usa sessionStorage.
        localStorage.setItem('username', found.username);

        // Redirigir al home
        location.href = 'home.html';
      } catch (error) {
        console.error(error);
        errEl.textContent = 'Error al intentar iniciar sesión. Revisa la consola.';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Entrar';
      }
    });
  </script>
</body>
</html>
